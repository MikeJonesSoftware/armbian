#!/bin/sh
#
# Copyright (c) Authors: http://www.armbian.com/authors
#
# This file is licensed under the terms of the GNU General Public
# License version 2. This program is licensed "as is" without any
# warranty of any kind, whether express or implied.
#
# truncate, save and clean logs if they get over 75% of the /var/log size
#

treshold=75 # %
logusage=$(df /var/log/ --output=pcent | tail -1 |cut -d "%" -f 1)
if [ $logusage -ge $treshold ]; then

		logrotate --force /etc/logrotate.d/
		# write to SD
		/usr/sbin/armbian/armbian-ram-logging write >/dev/null 2>&1
		# truncate
        /usr/bin/find /var/log -name '*.log' -or -name '*.xz' -or -name 'lastlog' -or -name 'messages' -or -name 'debug' -or -name 'syslog' | xargs truncate --size 0
		/usr/bin/find /var/log -name 'btmp' -or -name 'wtmp' | xargs truncate --size 0
		# remove
		/usr/bin/find /var/log -name '*.[0-9]' -or -name '*.gz' | xargs rm

fi